<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Test - PlacementSyncer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { margin: 5px; padding: 8px 15px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>PlacementSyncer Registration Test</h1>
    
    <div class="test-section info">
        <h3>Test User Information</h3>
        <p><strong>User ID:</strong> <span id="testUserId">test-user-2025</span></p>
        <p><strong>Email:</strong> <span id="testEmail">test@example.com</span></p>
    </div>

    <div class="test-section">
        <h3>Step 1: Test Registration API</h3>
        <button onclick="testRegistration()">Test Registration</button>
        <div id="registrationResult"></div>
    </div>

    <div class="test-section">
        <h3>Step 2: Test Dashboard API</h3>
        <button onclick="testDashboard()">Test Dashboard</button>
        <div id="dashboardResult"></div>
    </div>

    <div class="test-section">
        <h3>Step 3: Test Complete Flow</h3>
        <button onclick="testCompleteFlow()">Test Complete Flow</button>
        <div id="completeFlowResult"></div>
    </div>

    <script>
        const testUserId = 'test-user-2025';
        const testEmail = 'test@example.com';

        async function testRegistration() {
            const resultDiv = document.getElementById('registrationResult');
            resultDiv.innerHTML = '<p>Testing registration...</p>';

            try {
                const testData = {
                    firstName: 'Test',
                    lastName: 'User',
                    phone: '+1234567890',
                    department: 'Computer Science',
                    currentYear: 3,
                    currentCgpa: 8.5,
                    backlogs: 0,
                    linkedinUrl: 'https://linkedin.com/in/testuser',
                    githubUrl: 'https://github.com/testuser'
                };

                console.log('Sending registration data:', testData);

                const response = await fetch('/api/v1/profile-simple/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Appwrite-User-Id': testUserId,
                        'X-Appwrite-User-Email': testEmail
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                console.log('Registration result:', result);

                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ Registration Successful</h4>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>❌ Registration Failed</h4>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Registration test error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ Registration Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testDashboard() {
            const resultDiv = document.getElementById('dashboardResult');
            resultDiv.innerHTML = '<p>Testing dashboard...</p>';

            try {
                const response = await fetch('/api/v1/profile-simple/dashboard', {
                    method: 'GET',
                    headers: {
                        'X-Appwrite-User-Id': testUserId,
                        'X-Appwrite-User-Email': testEmail
                    }
                });

                const result = await response.json();
                console.log('Dashboard result:', result);

                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ Dashboard Load Successful</h4>
                            <h5>User Profile:</h5>
                            <pre>${JSON.stringify(result.data.userProfile, null, 2)}</pre>
                            <h5>Statistics:</h5>
                            <pre>${JSON.stringify(result.data.statistics, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>❌ Dashboard Load Failed</h4>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Dashboard test error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ Dashboard Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testCompleteFlow() {
            const resultDiv = document.getElementById('completeFlowResult');
            resultDiv.innerHTML = '<p>Testing complete flow...</p>';

            try {
                // Step 1: Register
                resultDiv.innerHTML += '<p>Step 1: Registering user...</p>';
                await testRegistration();

                // Wait a moment
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 2: Load Dashboard
                resultDiv.innerHTML += '<p>Step 2: Loading dashboard...</p>';
                await testDashboard();

                resultDiv.innerHTML += `
                    <div class="success">
                        <h4>✅ Complete Flow Test Finished</h4>
                        <p>Check the results above for both registration and dashboard tests.</p>
                    </div>
                `;
            } catch (error) {
                console.error('Complete flow test error:', error);
                resultDiv.innerHTML += `
                    <div class="error">
                        <h4>❌ Complete Flow Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Test API connectivity on page load
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('/api/v1/profile-simple/health');
                const result = await response.json();
                console.log('API Health Check:', result);
                
                if (result.success) {
                    document.body.insertAdjacentHTML('afterbegin', `
                        <div class="test-section success">
                            <h3>✅ API Health Check Passed</h3>
                            <p>Backend API is responding correctly.</p>
                            <p>Timestamp: ${result.timestamp}</p>
                        </div>
                    `);
                }
            } catch (error) {
                document.body.insertAdjacentHTML('afterbegin', `
                    <div class="test-section error">
                        <h3>❌ API Health Check Failed</h3>
                        <p>Backend API is not responding: ${error.message}</p>
                    </div>
                `);
            }
        });
    </script>
</body>
</html>
